(()=>{var e={29:e=>{"use strict";e.exports=require("koa-jwt")},101:e=>{"use strict";e.exports=require("koa")},316:e=>{"use strict";e.exports=require("koa-compose")},694:e=>{"use strict";e.exports=require("koa-static")},695:e=>{"use strict";e.exports=require("@koa/cors")},733:e=>{"use strict";e.exports=require("koa-router")},829:e=>{"use strict";e.exports=require("jsonwebtoken")},896:e=>{"use strict";e.exports=require("fs")},928:e=>{"use strict";e.exports=require("path")}},t={};function s(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,s),a.exports}const o=s(101),r=s(896),a=s(733),i=s(695),n=s(694),u=s(316),c=s(928),l=s(829),p=s(29),d="Gina",w=new o,g=new a;w.use((async(e,t)=>{const s=Date.now();await t();const o=Date.now()-s;e.set("X-Response-time",`${o}ms`)})),w.use(n(c.join(__dirname,"public"))),w.use((async(e,t)=>{await t()})),w.use((async(e,t)=>{try{await t()}catch(t){e.status=t.status||500,e.type="json",e.body={message:t.message},e.app.emit("error",t,e)}})),w.use((async(e,t)=>{e.header.authorization,console.log(`method: ${e.method}, url: ${e.url}`),await t()})),w.use(i()),w.use(p({secret:d,passthrough:["getJwtToken"]}).unless({path:[/^\/public/]})),w.use(u([async(e,t)=>{e.header.authorization||"/getJwtToken"===e.path?await t():e.throw(401,"not authed.")},async(e,t)=>{e.header.jwtToken?e.throw(401,"you don have access to system."):await t()}])),g.get("/getJwtToken",(async(e,t)=>{const{id:s}=e.query;await t();const o=l.sign({id:s},d,{expiresIn:"8h"});e.body={token:o}})),g.get("/login",(async(e,t)=>{console.log("login start...");const{name:s,prId:o}=e.query;await t();const a=await r.promises.readFile("./userInfo.json","utf8"),i=JSON.parse(a).filter((e=>e.id===+o&&s===e.name))?.[0];i||e.throw(400,"login failed."),e.body={...i},e.type="json",console.log("login end...")})),g.get("/getAllDetails",(async(e,t)=>{console.log("get details start..."),await t();const s=JSON.parse(await r.promises.readFile("./userInfo.json","utf-8"));s instanceof Array?e.body={data:s}:e.throw(400,"db fail")})),w.use(g.routes()).use(g.allowedMethods()),w.on("error",((e,t)=>{console.log("error",JSON.stringify(e))})),w.listen(8081,(()=>{}))})();